<!-- Header with logo -->
<div class="header" *ngIf="theme?.branding?.logoUrl">
  <img [src]="theme!.branding.logoUrl"
       alt="Logo"
       (click)="navigateHome()"
       class="header-logo" />
</div>

<div class="page">
  <div class="container">

    <!-- Registration card -->
    <div class="registration-card" *ngIf="theme?.content?.onboardingUrl">
      <h3>{{ 'login.registration' | translate }}</h3>
      <button (click)="navigateOnboarding()">
        {{ 'login.onboarding' | translate }}
      </button>
    </div>

    <!-- QR card -->
    <div class="card qr-card" *ngIf="!timedOut && !errorMessage">
      <div class="qr-card-content">

        <!-- Instructions (left) -->
        <div class="instructions">
          <h1 class="instructions-title">{{ 'login.instructions.title' | translate }}</h1>
          <ol>
            <li>
              <span *ngIf="theme?.content?.walletUrl; else noWalletLink">
                {{ 'login.instructions.step1.before' | translate }}
                <a [href]="theme!.content.walletUrl"
                   target="_blank"
                   rel="noopener noreferrer">{{ 'login.instructions.step1.link' | translate }}</a>
                {{ 'login.instructions.step1.after' | translate }}
              </span>
              <ng-template #noWalletLink>
                {{ 'login.instructions.step1.noLink' | translate }}
              </ng-template>
            </li>
            <li>{{ 'login.instructions.step2' | translate }}</li>
            <li>{{ 'login.instructions.step3' | translate }}</li>
          </ol>
        </div>

        <!-- QR container (right) -->
        <div class="qr-container">
          <div class="qr-frame" *ngIf="!sameDevice">
            <qrcode
              [qrdata]="authRequest"
              [width]="250"
              [errorCorrectionLevel]="'M'"
              [margin]="2">
            </qrcode>
          </div>
          <div class="qr-actions" *ngIf="!sameDevice">
            <span class="qr-title">{{ 'login.qr.hint' | translate }}</span>
            <button class="copy-button" (click)="copyAuthRequest()">
              <span class="material-icons">{{ copied ? 'check' : 'content_copy' }}</span>
              <span>{{ (copied ? 'login.qr.copied' : 'login.qr.copy') | translate }}</span>
            </button>
          </div>
          <div class="same-device-title" *ngIf="sameDevice">
            <h3>{{ 'login.sameDevice.title' | translate }}</h3>
          </div>
          <button class="wallet-button"
                  *ngIf="sameDevice && walletRedirectUrl"
                  (click)="openWallet()">
            <span class="material-icons">account_balance_wallet</span>
            {{ 'login.sameDevice.wallet' | translate }}
          </button>
        </div>

      </div>

      <!-- Same-device / QR toggle -->
      <div class="toggle-section" *ngIf="theme?.content?.walletUrl">
        <a *ngIf="!sameDevice" (click)="toggleSameDevice()">
          {{ 'login.sameDevice.switch' | translate }}
        </a>
        <a *ngIf="sameDevice" (click)="toggleSameDevice()">
          {{ 'login.qr.switch' | translate }}
        </a>
      </div>
    </div>

    <!-- Timeout message -->
    <div class="card timeout-card" *ngIf="timedOut">
      <p>{{ 'login.timeout' | translate }}</p>
    </div>

    <!-- Error message -->
    <div class="card error-card" *ngIf="errorMessage">
      <p>{{ errorMessage | translate }}</p>
    </div>

    <!-- Support card -->
    <div class="support-card" *ngIf="theme?.content?.supportUrl">
      <span>{{ 'login.support.question' | translate }}</span>
      <div class="help-container">
        <span class="material-icons">build</span>
        <span class="help">
          {{ 'login.support.before' | translate }}
          <a [href]="theme!.content.supportUrl"
             target="_blank"
             rel="noopener noreferrer">{{ 'login.support.link' | translate }}</a>
        </span>
      </div>
    </div>

  </div>
</div>
